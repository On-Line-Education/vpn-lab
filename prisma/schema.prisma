generator client {
    provider = "prisma-client-js"
}

datasource db {
    provider = "mysql"
    url      = env("DATABASE_URL")
}

model Hub {
    id        Int          @id @default(autoincrement())
    createdAt DateTime     @default(now())
    updatedAt DateTime     @updatedAt
    title     String       @unique
    server    Server       @relation(fields: [serverId], references: [id])
    serverId  Int
    users     UsersInHub[]
}

model User {
    id           Int          @id @default(autoincrement())
    name         String       @unique // same as vpnName
    passHash     String
    veyonKeyPub  String?
    veyonKeyPriv String?
    loginKey     String?      @unique
    // vpnPass      String // TODO: Generate password
    role         String
    hubs         UsersInHub[]
    Token        Token[]
}

model Token {
    id        Int      @id @default(autoincrement())
    user      User     @relation(fields: [userId], references: [id])
    userId    Int
    token     String
    createdAt DateTime @default(now())
    expireOn  DateTime
}

model Server {
    id           Int    @id @default(autoincrement())
    name         String
    presharedKey String // klucz logowania do vpn
    Hub          Hub[]
}

model UsersGroup {
    userGroup   UsersInHub @relation(fields: [userGroupId], references: [id])
    userGroupId Int
    groupName   String

    @@id([userGroupId])
}

model UsersInHub {
    id     Int  @id @default(autoincrement())
    user   User @relation(fields: [userId], references: [id])
    userId Int
    hub    Hub  @relation(fields: [hubId], references: [id])
    hubId  Int

    // @@id([userId, hubId])
    UsersGroup UsersGroup[]
}
